# Exemple visuel - Comment Ã§a marche

## Interface Home Assistant avant/aprÃ¨s

### AVANT (sans l'intÃ©gration)
```
Tableau de bord Home Assistant:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Votre maison              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  â€¢ Thermostat              â”‚
â”‚  â€¢ CamÃ©ras                 â”‚
â”‚  â€¢ Autres intÃ©grations...  â”‚
â”‚                             â”‚
â”‚  âŒ Pas de contrÃ´le pour    â”‚
â”‚     les lampes iSMART       â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APRÃˆS (avec l'intÃ©gration)
```
Tableau de bord Home Assistant:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Votre maison                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ã‰clairage                      â”‚
â”‚  â”œâ”€ ğŸ’¡ Parents          [ON]   â”‚
â”‚  â”œâ”€ ğŸ’¡ Dressing         [OFF]  â”‚
â”‚  â”œâ”€ ğŸ’¡ Gabriel          [ON]   â”‚
â”‚  â”œâ”€ ğŸ’¡ Cuisine          [OFF]  â”‚
â”‚  â”œâ”€ ğŸ’¡ Salon 1          [ON]   â”‚
â”‚  â”œâ”€ ğŸ’¡ Salon 2          [OFF]  â”‚
â”‚  â”œâ”€ ğŸ’¡ Terrasse         [ON]   â”‚
â”‚  â””â”€ ... 36 autres lampes        â”‚
â”‚                                 â”‚
â”‚  Appareils spÃ©ciaux             â”‚
â”‚  â”œâ”€ ğŸŒ± Arrosage auto    [OFF]  â”‚
â”‚  â”œâ”€ ğŸš— Borne VE         [ON]   â”‚
â”‚  â””â”€ ğŸ”Œ Charge Scooter  [OFF]   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flux rÃ©el - Cliquer sur une lampe

```
1ï¸âƒ£ UTILISATEUR CLIQUE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Home Assistant UI    â”‚
   â”‚                      â”‚
   â”‚ ğŸ’¡ Parents  [OFF]   â”‚
   â”‚    â† Clic ici!       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚

2ï¸âƒ£ HOME ASSISTANT REÃ‡OIT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ISmartModbusLight        â”‚
   â”‚.async_turn_on()          â”‚
   â”‚                          â”‚
   â”‚ PrÃ©pare la commande      â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚

3ï¸âƒ£ REQUÃŠTE HTTP ENVOYÃ‰E
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /writeCoil[1,0x2C00,1]         â”‚
   â”‚                                    â”‚
   â”‚ Device: 1 (device Modbus)         â”‚
   â”‚ Addr: 0x2C00 (adresse de la lampe)â”‚
   â”‚ Value: 1 (allumer)                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ HTTP
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Serveur Modbus          â”‚
   â”‚ 192.168.1.11:2080       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚

4ï¸âƒ£ SERVEUR EXÃ‰CUTE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Automate Modbus Device 1    â”‚
   â”‚                             â”‚
   â”‚ Envoie le signal:           â”‚
   â”‚ â†’ Allumer sortie 0x2C00     â”‚
   â”‚                             â”‚
   â”‚ âœ… Lampe Parents s'allume   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5ï¸âƒ£ RÃ‰PONSE HTTP
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ HTTP 200 OK      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Home Assistant         â”‚
   â”‚                        â”‚
   â”‚ Ã‰tat local = ON        â”‚
   â”‚ Interface mise Ã  jour  â”‚
   â”‚                        â”‚
   â”‚ ğŸ’¡ Parents  [ON]      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6ï¸âƒ£ MISE Ã€ JOUR AUTOMATIQUE (30 secondes)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Toutes les 30 sec:   â”‚
   â”‚                      â”‚
   â”‚ GET /getState        â”‚
   â”‚ â†“                    â”‚
   â”‚ Parser rÃ©ponse       â”‚
   â”‚ â†“                    â”‚
   â”‚ Extraire l'Ã©tat      â”‚
   â”‚ â†“                    â”‚
   â”‚ Synchroniser HA      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RÃ©ponse getState expliquÃ©e

```
RÃ©ponse brute du serveur:
[1,1,1,1,1][128,0,0,0,0][2048,0,0,0,0]

ParsÃ©e:
â”œâ”€ validState = [1,1,1,1,1]
â”‚   â””â”€ Toutes les donnÃ©es sont valides âœ“
â”‚
â”œâ”€ outState = [128,0,0,0,0]
â”‚   â”œâ”€ Device 1: 128 = 0b10000000 (bits 7 actif)
â”‚   â”‚   â””â”€ Sorties Q0-Q7 du device 1
â”‚   â”‚       â”œâ”€ Q0 (index 0): âŒ OFF
â”‚   â”‚       â”œâ”€ Q1 (index 1): âŒ OFF
â”‚   â”‚       â”œâ”€ Q2 (index 2): âŒ OFF
â”‚   â”‚       â”œâ”€ Q3 (index 3): âŒ OFF
â”‚   â”‚       â”œâ”€ Q4 (index 4): âŒ OFF
â”‚   â”‚       â”œâ”€ Q5 (index 5): âŒ OFF
â”‚   â”‚       â”œâ”€ Q6 (index 6): âŒ OFF
â”‚   â”‚       â””â”€ Q7 (index 7): âœ… ON
â”‚   â”‚
â”‚   â””â”€ Autres devices: Tous Ã  0 (tout OFF)
â”‚
â””â”€ memState = [2048,0,0,0,0]
    â””â”€ Device 5: 2048 = 0x0800 = 0b100000000000
        â””â”€ Bit 11 actif â†’ Arrosage auto (M0B) : ON âœ…
```

## Configuration JSON en images

```
Fichier example_config.json:

[
  {
    "name": "Parents",      â† Nom affichÃ© dans HA
    "device": 1,            â† Device Modbus (1-5)
    "index": 0,             â† Bit Ã  lire (0-15 ou 100+)
    "addr": "0x2C00"        â† Adresse pour writeCoil
  },
  {
    "name": "Cuisine",
    "device": 2,
    "index": 2,
    "addr": "0x2C02"
  },
  ...
]

Dans Home Assistant HA crÃ©e:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LumiÃ¨res dÃ©couvertes    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Parents              â”‚
â”‚ âœ… Cuisine              â”‚
â”‚ âœ… ... (43 au total)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cycle de mise Ã  jour complet

```
DÃ©marrage
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Assistant charge             â”‚
â”‚ l'intÃ©gration iSMART Modbus       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pour chaque lampe en config:      â”‚
â”‚                                  â”‚
â”‚ 1. CrÃ©er entitÃ© light.parents    â”‚
â”‚ 2. Ã‰tat initial = unknown        â”‚
â”‚ 3. async_update() appelÃ©         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Premier getState                 â”‚
â”‚                                  â”‚
â”‚ GET /getState                    â”‚
â”‚ Response: [1,1,1,1,1][...]       â”‚
â”‚                                  â”‚
â”‚ Parser et dÃ©coder chaque lampe   â”‚
â”‚ â†“                                â”‚
â”‚ light.parents.is_on = False      â”‚
â”‚ light.kitchen.is_on = True       â”‚
â”‚ ... (43 lampes)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Assistant affiche            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ’¡ Parents      [OFF]      â”‚   â”‚
â”‚ â”‚ ğŸ’¡ Cuisine      [ON]       â”‚   â”‚
â”‚ â”‚ ... (prÃªt Ã  l'emploi)      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toutes les 30 secondes:          â”‚
â”‚                                  â”‚
â”‚ Timer tick                       â”‚
â”‚ â†“                                â”‚
â”‚ async_update() pour chaque lampe â”‚
â”‚ â†“                                â”‚
â”‚ GET /getState                    â”‚
â”‚ â†“                                â”‚
â”‚ Parser et comparer avec Ã©tat loc â”‚
â”‚ â†“                                â”‚
â”‚ Si changement: Notifier HA       â”‚
â”‚ â†“                                â”‚
â”‚ Mettre Ã  jour l'interface        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
        RÃ©pÃ©ter...
```

## Actions utilisateur possibles

```
Interface Home Assistant:

Clic sur "Parents" [OFF]
          â†“
    async_turn_on()
          â†“
    /writeCoil[1,0x2C00,1]
          â†“
    Serveur exÃ©cute
          â†“
    Parents s'allume âœ…
          â†“
    Mise Ã  jour reÃ§ue aprÃ¨s 30s
          â†“
    Interface reflÃ¨te l'Ã©tat rÃ©el

---

Automatisation:
"Allumer le salon Ã  20h"
          â†“
    automation dÃ©clenche
          â†“
    appelle light.turn_on
          â†“
    /writeCoil[2,0x2C00,1]
          â†“
    Salon s'allume âœ…

---

Routines vocales (Alexa/Google):
"Alexa, allume la cuisine"
          â†“
    Alexa appelle Home Assistant
          â†“
    HA exÃ©cute light.turn_on
          â†“
    /writeCoil[2,0x2C02,1]
          â†“
    Cuisine s'allume âœ…
```

## DÃ©bogage en images

```
Si quelque chose n'est pas bon:

1. VÃ©rifier les logs:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ParamÃ¨tres                  â”‚
   â”‚ â†’ SystÃ¨me                   â”‚
   â”‚ â†’ Journaux                  â”‚
   â”‚ â†’ Chercher "ismart_modbus"  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Logs typiques:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 2024-01-19 12:00:00 DEBUG          â”‚
   â”‚ ... light.py LumiÃ¨re Parents       â”‚
   â”‚ allumÃ©e                            â”‚
   â”‚                                    â”‚
   â”‚ 2024-01-19 12:00:00 DEBUG          â”‚
   â”‚ ... light.py Parsing: device=1,    â”‚
   â”‚ index=0, bit=1 â†’ ON                â”‚
   â”‚                                    â”‚
   â”‚ 2024-01-19 12:00:30 ERROR          â”‚
   â”‚ ... Connexion timeout au serveur   â”‚
   â”‚ â†’ Marquer unavailable              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. VÃ©rifier la connexion:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Tester l'URL:                       â”‚
   â”‚ http://192.168.1.11:2080/getState   â”‚
   â”‚                                     â”‚
   â”‚ Si Ã§a rÃ©pond: âœ… Serveur OK         â”‚
   â”‚ Si timeout: âŒ VÃ©rifier l'IP/port   â”‚
   â”‚ Si erreur: âŒ Serveur Modbus down   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Installation visuelle

```
AVANT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Assistant                   â”‚
â”‚                                  â”‚
â”‚ Tableaux de bord                 â”‚
â”‚ Automations                      â”‚
â”‚ Scripts                          â”‚
â”‚ â”‚                                â”‚
â”‚ â”œâ”€ Autres intÃ©grations           â”‚
â”‚ â””â”€ âŒ Pas de lampes iSMART        â”‚
â”‚                                  â”‚
â”‚ Besoin d'utiliser l'interface    â”‚
â”‚ Web du serveur Modbus            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ Installation HACS â†“

APRÃˆS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Assistant                   â”‚
â”‚                                  â”‚
â”‚ Tableaux de bord                 â”‚
â”‚ â”œâ”€ Afficher 43 lampes            â”‚
â”‚ â”œâ”€ Boutons ON/OFF                â”‚
â”‚ â””â”€ Mise Ã  jour live              â”‚
â”‚                                  â”‚
â”‚ Automations                      â”‚
â”‚ â”œâ”€ DÃ©clencher sur lampes         â”‚
â”‚ â”œâ”€ Allumer/Ã©teindre via HA       â”‚
â”‚ â””â”€ ScÃ©narios possibles           â”‚
â”‚                                  â”‚
â”‚ Scripts                          â”‚
â”‚ â”œâ”€ Combiner plusieurs lampes     â”‚
â”‚ â”œâ”€ Conditions avancÃ©es           â”‚
â”‚ â””â”€ Routines complexes            â”‚
â”‚                                  â”‚
â”‚ IntÃ©grations                     â”‚
â”‚ â”œâ”€ Autres intÃ©grations           â”‚
â”‚ â””â”€ âœ… iSMART Modbus (nouvelle!)  â”‚
â”‚                                  â”‚
â”‚ âœ¨ Tout centralisÃ© dans HA âœ¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**VoilÃ  comment Ã§a fonctionne en images!** ğŸ¨

PrÃªt Ã  essayer? Lisez [QUICKSTART.md](QUICKSTART.md)! ğŸš€
